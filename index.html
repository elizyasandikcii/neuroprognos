<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroPrognos | HD Risk Assessment with Symptom Selection</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        :root {
            --primary: #2a5c8a;
            --secondary: #4a9fd5;
            --accent: #ff6b6b;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        /* Header & Navigation */
        header {
            background-color: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .logo-icon {
            color: var(--secondary);
            font-size: 1.8rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: var(--transition);
            padding: 5px 0;
            position: relative;
        }

        nav a:hover {
            color: var(--primary);
        }

        nav a.active {
            color: var(--primary);
        }

        nav a.active:after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary);
        }

        .cta-button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
        }

        .cta-button:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
        }

        /* Hero Section */
        .hero {
            padding: 80px 0;
            background: linear-gradient(135deg, rgba(42, 92, 138, 0.05) 0%, rgba(74, 159, 213, 0.05) 100%);
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .hero h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            color: var(--primary);
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Calculator Selector */
        .calculator-selector {
            text-align: center;
            margin: 40px 0 20px;
        }

        .selector-container {
            display: inline-flex;
            background: white;
            border-radius: var(--border-radius);
            padding: 5px;
            box-shadow: var(--shadow);
            margin-top: 20px;
        }

        .selector-btn {
            padding: 12px 30px;
            border: none;
            background: none;
            font-weight: 600;
            cursor: pointer;
            border-radius: calc(var(--border-radius) - 2px);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .selector-btn.active {
            background-color: var(--primary);
            color: white;
        }

        .selector-btn:not(.active):hover {
            background-color: rgba(42, 92, 138, 0.1);
        }

        /* Calculator Tabs */
        .calculator-tab {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .calculator-tab.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Calculator Section */
        .section {
            padding: 60px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-title h2 {
            font-size: 2.3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .calculator-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 40px;
            margin-top: 20px;
        }

        @media (max-width: 992px) {
            .calculator-container {
                grid-template-columns: 1fr;
            }
        }

        .calculator-form {
            overflow-y: auto;
            max-height: 800px;
            padding-right: 10px;
        }

        /* IMPROVED SYMPTOM SELECTION STYLES */
        .symptom-category {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--primary);
            transition: var(--transition);
        }

        .symptom-category:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .symptom-category.motor {
            border-left-color: var(--danger);
        }

        .symptom-category.cognitive {
            border-left-color: var(--warning);
        }

        .symptom-category.psychiatric {
            border-left-color: var(--info);
        }

        .symptom-category.functional {
            border-left-color: var(--secondary);
        }

        .symptom-category h4 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }

        .symptom-category h4 i {
            font-size: 1.3rem;
        }

        .symptom-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .symptom-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--light);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
        }

        .symptom-item:hover {
            background: white;
            border-color: var(--secondary);
            transform: translateX(5px);
        }

        .symptom-item.selected {
            background: rgba(42, 92, 138, 0.08);
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(42, 92, 138, 0.15);
        }

        /* Custom Checkbox */
        .symptom-checkbox {
            position: relative;
            width: 22px;
            height: 22px;
            flex-shrink: 0;
            margin-right: 15px;
        }

        .symptom-checkbox input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            width: 22px;
            height: 22px;
            background: white;
            border: 2px solid var(--gray);
            border-radius: 4px;
            transition: var(--transition);
        }

        .symptom-checkbox input:checked ~ .checkmark {
            background: var(--primary);
            border-color: var(--primary);
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
            left: 7px;
            top: 3px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .symptom-checkbox input:checked ~ .checkmark:after {
            display: block;
        }

        .symptom-label {
            flex-grow: 1;
            font-weight: 500;
            color: var(--dark);
        }

        /* Severity Selector */
        .severity-selector {
            display: flex;
            gap: 8px;
            margin-left: auto;
            flex-shrink: 0;
        }

        .severity-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .severity-btn.mild {
            background: var(--success);
        }

        .severity-btn.moderate {
            background: var(--warning);
        }

        .severity-btn.severe {
            background: var(--danger);
        }

        .severity-btn.active {
            transform: scale(1.2);
            box-shadow: 0 0 0 2px white, 0 0 0 4px currentColor;
        }

        .severity-btn:hover {
            transform: scale(1.1);
        }

        .severity-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            margin-bottom: 8px;
        }

        .severity-btn:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Results Container */
        .results-container {
            background-color: rgba(42, 92, 138, 0.05);
            border-radius: var(--border-radius);
            padding: 30px;
            overflow-y: auto;
            max-height: 800px;
        }

        .results-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }

        .risk-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: 700;
            box-shadow: var(--shadow);
        }

        .risk-low {
            background: linear-gradient(135deg, var(--success), #20c997);
        }

        .risk-medium {
            background: linear-gradient(135deg, var(--warning), #fd7e14);
        }

        .risk-high {
            background: linear-gradient(135deg, var(--danger), #c92a2a);
        }

        /* Selected Symptoms Display */
        .selected-symptoms {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .selected-symptoms h4 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .selected-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .selected-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .selected-item .severity-badge {
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .severity-mild {
            background: rgba(40, 167, 69, 0.15);
            color: var(--success);
        }

        .severity-moderate {
            background: rgba(255, 193, 7, 0.15);
            color: var(--warning);
        }

        .severity-severe {
            background: rgba(220, 53, 69, 0.15);
            color: var(--danger);
        }

        .symptom-count {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        /* Risk Metrics */
        .risk-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .progress-steps:before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: var(--light-gray);
            z-index: 0;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
            cursor: pointer;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
            margin-bottom: 8px;
        }

        .step.active .step-number {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Form Steps */
        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(74, 159, 213, 0.2);
        }

        /* Graph Container Styles */
        .graph-container {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .graph-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-gray);
        }

        .graph-title h4 {
            color: var(--primary);
            font-size: 1.1rem;
        }

        .graph-controls {
            display: flex;
            gap: 10px;
        }

        .graph-type-btn {
            padding: 6px 12px;
            border: 1px solid var(--light-gray);
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .graph-type-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .graph-type-btn:hover {
            background: var(--light-gray);
        }

        /* Percentage Display Styles */
        .percentage-display {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .percentage-bar {
            flex: 1;
            height: 20px;
            background: var(--light-gray);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .percentage-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .percentage-value {
            min-width: 50px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .percentage-label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 5px;
        }

        /* DISCLAIMER SECTION */
        .disclaimer-section {
            background: var(--light-gray);
            padding: 50px 0;
            margin-top: 40px;
        }

        .disclaimer-box {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border-left: 5px solid var(--warning);
        }

        .disclaimer-box h3 {
            color: var(--warning);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .disclaimer-content {
            color: var(--gray);
            line-height: 1.8;
        }

        .disclaimer-content ul {
            margin: 15px 0 15px 20px;
        }

        .disclaimer-content li {
            margin-bottom: 8px;
        }

        /* CONTACT SECTION */
        .contact-section {
            background: white;
            padding: 50px 0;
        }

        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            margin-top: 30px;
        }

        .contact-card {
            background: var(--light);
            padding: 30px;
            border-radius: var(--border-radius);
            text-align: center;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .contact-card:hover {
            border-color: var(--secondary);
            transform: translateY(-5px);
        }

        .contact-icon {
            width: 60px;
            height: 60px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 20px;
        }

        .contact-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .contact-card p {
            color: var(--gray);
            margin-bottom: 15px;
        }

        .contact-link {
            color: var(--secondary);
            text-decoration: none;
            font-weight: 500;
            display: inline-block;
            margin-top: 10px;
        }

        .contact-link:hover {
            text-decoration: underline;
        }

        /* Footer */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 60px 0 30px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-links h4 {
            margin-bottom: 20px;
            color: white;
        }

        .footer-links ul {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: #adb5bd;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: white;
        }

        /* ===== ENHANCED GRAPH STYLES ===== */
        .symptom-cluster-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .cluster-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .cluster-filters {
            display: flex;
            gap: 10px;
        }

        .cluster-filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--light-gray);
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .cluster-filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .cluster-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .cluster-card {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 20px;
            border-left: 4px solid;
            transition: var(--transition);
        }

        .cluster-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .cluster-card.motor {
            border-left-color: var(--danger);
        }

        .cluster-card.cognitive {
            border-left-color: var(--warning);
        }

        .cluster-card.psychiatric {
            border-left-color: var(--info);
        }

        .cluster-card.functional {
            border-left-color: var(--secondary);
        }

        .cluster-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .cluster-title h5 {
            color: var(--dark);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cluster-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .cluster-bar {
            height: 8px;
            background: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .cluster-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .cluster-breakdown {
            margin-top: 15px;
        }

        .cluster-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .cluster-item:last-child {
            border-bottom: none;
        }

        .item-name {
            font-size: 0.9rem;
            color: var(--dark);
        }

        .item-value {
            font-weight: 600;
            color: var(--primary);
        }

        /* Advanced Risk Metrics */
        .advanced-metrics {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        @media (max-width: 768px) {
            .advanced-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .metric-advanced {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-top: 4px solid;
        }

        .metric-advanced.primary {
            border-top-color: var(--primary);
        }

        .metric-advanced.warning {
            border-top-color: var(--warning);
        }

        .metric-advanced.danger {
            border-top-color: var(--danger);
        }

        .metric-advanced.success {
            border-top-color: var(--success);
        }

        .metric-advanced .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-advanced .metric-label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 8px;
        }

        .metric-subtext {
            font-size: 0.75rem;
            color: var(--gray);
            margin-top: 5px;
        }

        /* Progression Timeline */
        .timeline-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-top: 20px;
            box-shadow: var(--shadow);
        }

        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline-item {
            display: flex;
            margin-bottom: 25px;
            position: relative;
        }

        .timeline-marker {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            border: 3px solid;
            position: relative;
            z-index: 2;
            flex-shrink: 0;
            margin-right: 20px;
        }

        .timeline-content {
            flex: 1;
            padding: 10px 15px;
            background: var(--light);
            border-radius: var(--border-radius);
            border-left: 3px solid;
        }

        .timeline-content h5 {
            margin-bottom: 5px;
            color: var(--dark);
        }

        .timeline-content p {
            font-size: 0.9rem;
            color: var(--gray);
            margin: 0;
        }

        /* Real Data Badge */
        .real-data-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, var(--success), #20c997);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }

        /* Formula Display */
        .formula-display {
            background: rgba(42, 92, 138, 0.05);
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 4px 4px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .formula-title {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Research Reference */
        .research-ref {
            font-size: 0.8rem;
            color: var(--gray);
            font-style: italic;
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px dashed var(--light-gray);
        }

        /* Comparison Container */
        .comparison-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .comparison-card {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 3px 15px rgba(0,0,0,0.08);
            text-align: center;
        }

        .comparison-label {
            font-weight: 600;
            color: var(--gray);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .comparison-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .comparison-baseline {
            font-size: 0.85rem;
            color: var(--gray);
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 20px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .calculator-container {
                padding: 20px;
            }
            
            .risk-metrics {
                grid-template-columns: 1fr;
            }
            
            .severity-selector {
                flex-direction: column;
                gap: 5px;
            }
            
            .severity-btn {
                width: 25px;
                height: 25px;
                font-size: 0.7rem;
            }
            
            .contact-grid {
                grid-template-columns: 1fr;
            }
            
            .cluster-grid {
                grid-template-columns: 1fr;
            }
            
            .comparison-container {
                grid-template-columns: 1fr;
            }
        }

        /* Secondary Button */
        .cta-button.secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .cta-button.secondary:hover {
            background: rgba(42, 92, 138, 0.1);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Header & Navigation -->
    <header>
        <div class="container">
            <div class="nav-container">
                <div class="logo">
                    <i class="fas fa-brain logo-icon"></i>
                    <span>NeuroPrognos</span>
                </div>
                <nav>
                    <ul id="navMenu">
                        <li><a href="#home" class="active">Home</a></li>
                        <li><a href="#calculator">Risk Calculator</a></li>
                        <li><a href="#what-is-hd">What is HD</a></li>
                        <li><a href="#our-methods">Our Methods</a></li>
                    </ul>
                </nav>
                <a href="#calculator" class="cta-button">Start Assessment</a>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <div class="hero-content">
                <h1>Huntington's Disease Risk Assessment</h1>
                <p>Select your specific symptoms for personalized risk calculation and treatment recommendations.</p>
                <a href="#calculator" class="cta-button">Choose Your Assessment Type <i class="fas fa-arrow-right"></i></a>
            </div>
        </div>
    </section>

    <!-- Calculator Section -->
    <section class="section" id="calculator">
        <div class="container">
            <div class="section-title">
                <h2>HD Risk Calculator with Symptom Selection</h2>
                <p>Select your specific symptoms for personalized risk calculation</p>
            </div>
            
            <div class="calculator-selector">
                <div class="selector-container">
                    <button class="selector-btn active" id="tabKnownBtn">
                        <i class="fas fa-dna"></i>
                        Known CAG Repeat <span class="real-data-badge">REAL Formula</span>
                    </button>
                    <button class="selector-btn" id="tabUnknownBtn">
                        <i class="fas fa-question-circle"></i>
                        Unknown CAG Repeat
                    </button>
                </div>
            </div>
            
            <!-- Known CAG Repeat Tab -->
            <div class="calculator-tab active" id="tabKnown">
                <div class="progress-steps">
                    <div class="step active" data-step="1" onclick="goToStep('known', 1)">
                        <div class="step-number">1</div>
                        <div class="step-label">Genetic Info</div>
                    </div>
                    <div class="step" data-step="2" onclick="goToStep('known', 2)">
                        <div class="step-number">2</div>
                        <div class="step-label">Motor Symptoms</div>
                    </div>
                    <div class="step" data-step="3" onclick="goToStep('known', 3)">
                        <div class="step-number">3</div>
                        <div class="step-label">Cognitive Symptoms</div>
                    </div>
                    <div class="step" data-step="4" onclick="goToStep('known', 4)">
                        <div class="step-number">4</div>
                        <div class="step-label">Psychiatric Symptoms</div>
                    </div>
                </div>
                
                <div class="calculator-container">
                    <div class="calculator-form">
                        <!-- Step 1: Genetic Information -->
                        <div class="form-step active" id="knownStep1">
                            <h3>Genetic Information</h3>
                            
                            <div class="form-group">
                                <label for="knownAge">Current Age</label>
                                <input type="number" id="knownAge" min="18" max="100" value="35">
                            </div>
                            
                            <div class="form-group">
                                <label for="knownCAG">CAG Repeat Length</label>
                                <input type="number" id="knownCAG" min="10" max="100" value="42">
                            </div>
                            
                            <button class="cta-button" onclick="nextStep('known')">
                                Next: Motor Symptoms <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                        
                        <!-- Step 2: Motor Symptoms -->
                        <div class="form-step" id="knownStep2">
                            <h3>Motor Symptoms</h3>
                            <p>Select the motor symptoms you're experiencing</p>
                            
                            <div class="symptom-category motor" id="motorSymptoms">
                                <h4><i class="fas fa-running"></i> Motor Symptoms</h4>
                                <div class="symptom-list" id="motorList">
                                    <!-- Symptoms will be added by JavaScript -->
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 15px; margin-top: 20px;">
                                <button class="cta-button secondary" onclick="prevStep('known')">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="cta-button" onclick="nextStep('known')">
                                    Next: Cognitive Symptoms <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Step 3: Cognitive Symptoms -->
                        <div class="form-step" id="knownStep3">
                            <h3>Cognitive Symptoms</h3>
                            <p>Select cognitive symptoms you're experiencing</p>
                            
                            <div class="symptom-category cognitive" id="cognitiveSymptoms">
                                <h4><i class="fas fa-brain"></i> Cognitive Symptoms</h4>
                                <div class="symptom-list" id="cognitiveList">
                                    <!-- Symptoms will be added by JavaScript -->
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 15px; margin-top: 20px;">
                                <button class="cta-button secondary" onclick="prevStep('known')">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="cta-button" onclick="nextStep('known')">
                                    Next: Psychiatric Symptoms <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Step 4: Psychiatric Symptoms -->
                        <div class="form-step" id="knownStep4">
                            <h3>Psychiatric & Functional Symptoms</h3>
                            <p>Select psychiatric symptoms and functional impacts</p>
                            
                            <div class="symptom-category psychiatric" id="psychiatricSymptoms">
                                <h4><i class="fas fa-heartbeat"></i> Psychiatric Symptoms</h4>
                                <div class="symptom-list" id="psychiatricList">
                                    <!-- Symptoms will be added by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="symptom-category functional" id="functionalSymptoms">
                                <h4><i class="fas fa-tasks"></i> Functional Impact</h4>
                                <div class="symptom-list" id="functionalList">
                                    <!-- Symptoms will be added by JavaScript -->
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 15px; margin-top: 20px;">
                                <button class="cta-button secondary" onclick="prevStep('known')">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="cta-button" id="calculateKnownRiskBtn">
                                    <i class="fas fa-calculator"></i> Calculate Risk
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="results-container">
                        <div class="results-header">
                            <div class="risk-circle risk-medium" id="knownRiskCircle">
                                <span id="knownRiskPercentage">--%</span>
                            </div>
                            <h3 id="knownRiskCategory">Complete assessment to see results</h3>
                            <p id="knownRiskDescription">Based on your specific symptoms and genetic profile</p>
                            
                            <div class="formula-display">
                                <div class="formula-title">
                                    <i class="fas fa-calculator"></i>
                                    HD Real Formula (Langbehn Model)
                                </div>
                                μ = (Age × CAG) / 1000; Probability = 1 / (1 + e^(9.56 - 0.146×μ))
                                <div class="research-ref">
                                    Based on Langbehn et al., Neurology 2004
                                </div>
                            </div>
                        </div>
                        
                        <!-- Selected Symptoms Display -->
                        <div class="selected-symptoms">
                            <h4><i class="fas fa-clipboard-list"></i> Selected Symptoms <span class="symptom-count" id="knownSymptomCount">0</span></h4>
                            <div class="selected-list" id="knownSelectedList">
                                <div style="text-align: center; color: var(--gray); padding: 20px;">
                                    <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.5;"></i>
                                    <p>No symptoms selected yet</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="advanced-metrics">
                            <div class="metric-advanced primary">
                                <div class="metric-value" id="realCAPScore">--</div>
                                <div class="metric-label">CAP Score (μ)</div>
                                <div class="metric-subtext">(CAG × Age)/1000</div>
                            </div>
                            <div class="metric-advanced warning">
                                <div class="metric-value" id="realProgressionRate">--</div>
                                <div class="metric-label">Progression Rate</div>
                                <div class="metric-subtext">UHDRS/year</div>
                            </div>
                            <div class="metric-advanced danger">
                                <div class="metric-value" id="realTFCDecline">--</div>
                                <div class="metric-label">TFC Decline</div>
                                <div class="metric-subtext">Units/year</div>
                            </div>
                            <div class="metric-advanced success">
                                <div class="metric-value" id="realAgeOnset">--</div>
                                <div class="metric-label">Expected Onset</div>
                                <div class="metric-subtext">Age ± 5 years</div>
                            </div>
                        </div>
                        
                        <!-- Symptom Cluster Analysis -->
                        <div class="symptom-cluster-container">
                            <div class="cluster-header">
                                <h4><i class="fas fa-project-diagram"></i> Symptom Cluster Analysis</h4>
                                <div class="cluster-filters">
                                    <button class="cluster-filter-btn active" onclick="viewCluster('all')">All</button>
                                    <button class="cluster-filter-btn" onclick="viewCluster('motor')">Motor</button>
                                    <button class="cluster-filter-btn" onclick="viewCluster('cognitive')">Cognitive</button>
                                    <button class="cluster-filter-btn" onclick="viewCluster('psychiatric')">Psychiatric</button>
                                </div>
                            </div>
                            
                            <div class="cluster-grid" id="symptomClusterGrid">
                                <!-- Will be filled by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Comparison Container -->
                        <div class="comparison-container">
                            <div class="comparison-card">
                                <div class="comparison-label">General Population</div>
                                <div class="comparison-value">0.01%</div>
                                <div class="comparison-baseline">Baseline risk</div>
                            </div>
                            <div class="comparison-card">
                                <div class="comparison-label">Your Estimated Risk</div>
                                <div class="comparison-value" id="comparisonRisk">--%</div>
                                <div class="comparison-baseline">Based on symptoms</div>
                            </div>
                            <div class="comparison-card">
                                <div class="comparison-label">Relative Increase</div>
                                <div class="comparison-value" id="relativeIncrease">--x</div>
                                <div class="comparison-baseline">Compared to baseline</div>
                            </div>
                        </div>
                        
                        <!-- Disease Progression Timeline -->
                        <div class="timeline-container">
                            <h4><i class="fas fa-road"></i> Disease Progression Timeline</h4>
                            <div class="timeline">
                                <div class="timeline-item">
                                    <div class="timeline-marker" style="border-color: var(--success);"></div>
                                    <div class="timeline-content" style="border-left-color: var(--success);">
                                        <h5>Premanifest Stage</h5>
                                        <p id="premanifestTimeline">CAG expansion present but no significant symptoms</p>
                                    </div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-marker" style="border-color: var(--warning);"></div>
                                    <div class="timeline-content" style="border-left-color: var(--warning);">
                                        <h5>Prodromal Stage</h5>
                                        <p id="prodromalTimeline">Early subtle symptoms, mild functional impact</p>
                                    </div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-marker" style="border-color: var(--danger);"></div>
                                    <div class="timeline-content" style="border-left-color: var(--danger);">
                                        <h5>Manifest HD</h5>
                                        <p id="manifestTimeline">Clear motor symptoms, diagnosis typically made</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Graph Container -->
                        <div class="graph-container">
                            <div class="graph-title">
                                <h4><i class="fas fa-chart-line"></i> Disease Progression Timeline</h4>
                                <div class="graph-controls">
                                    <button class="graph-type-btn active" onclick="changeGraphType('known', 'line')">Line</button>
                                    <button class="graph-type-btn" onclick="changeGraphType('known', 'bar')">Bar</button>
                                    <button class="graph-type-btn" onclick="toggleConfidenceIntervals('known')">±CI</button>
                                </div>
                            </div>
                            <div style="height: 250px; position: relative;">
                                <canvas id="knownProgressionChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Risk Factor Percentage Breakdown -->
                        <div class="graph-container">
                            <div class="graph-title">
                                <h4><i class="fas fa-percentage"></i> Risk Factor Percentage Breakdown</h4>
                            </div>
                            <div id="knownPercentageBreakdown">
                                <!-- Percentage bars will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Unknown CAG Repeat Tab -->
            <div class="calculator-tab" id="tabUnknown">
                <div class="progress-steps">
                    <div class="step active" data-step="1" onclick="goToStep('unknown', 1)">
                        <div class="step-number">1</div>
                        <div class="step-label">Family History</div>
                    </div>
                    <div class="step" data-step="2" onclick="goToStep('unknown', 2)">
                        <div class="step-number">2</div>
                        <div class="step-label">Symptoms</div>
                    </div>
                    <div class="step" data-step="3" onclick="goToStep('unknown', 3)">
                        <div class="step-number">3</div>
                        <div class="step-label">Risk Factors</div>
                    </div>
                </div>
                
                <div class="calculator-container">
                    <div class="calculator-form">
                        <!-- Step 1: Family History -->
                        <div class="form-step active" id="unknownStep1">
                            <h3>Family History & Demographics</h3>
                            
                            <div class="form-group">
                                <label for="unknownAge">Current Age</label>
                                <input type="number" id="unknownAge" min="18" max="100" value="35">
                            </div>
                            
                            <div class="form-group">
                                <label for="familyHistory">Family History of HD</label>
                                <select id="familyHistory">
                                    <option value="none">No family history</option>
                                    <option value="first">First-degree relative</option>
                                    <option value="second">Second-degree relative</option>
                                    <option value="multiple">Multiple relatives</option>
                                </select>
                            </div>
                            
                            <button class="cta-button" onclick="nextStep('unknown')">
                                Next: Symptom Selection <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                        
                        <!-- Step 2: Symptoms -->
                        <div class="form-step" id="unknownStep2">
                            <h3>Symptom Selection</h3>
                            <p>Select symptoms you're currently experiencing</p>
                            
                            <div class="symptom-category motor">
                                <h4><i class="fas fa-running"></i> Motor Symptoms</h4>
                                <div class="symptom-list" id="unknownMotorList">
                                    <!-- Symptoms will be added by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="symptom-category cognitive">
                                <h4><i class="fas fa-brain"></i> Cognitive Symptoms</h4>
                                <div class="symptom-list" id="unknownCognitiveList">
                                    <!-- Symptoms will be added by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="symptom-category psychiatric">
                                <h4><i class="fas fa-heartbeat"></i> Psychiatric Symptoms</h4>
                                <div class="symptom-list" id="unknownPsychiatricList">
                                    <!-- Symptoms will be added by JavaScript -->
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 15px; margin-top: 20px;">
                                <button class="cta-button secondary" onclick="prevStep('unknown')">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="cta-button" onclick="nextStep('unknown')">
                                    Next: Additional Factors <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Step 3: Additional Factors -->
                        <div class="form-step" id="unknownStep3">
                            <h3>Additional Risk Factors</h3>
                            
                            <div class="form-group">
                                <label for="unknownSymptomDuration">
                                    How long have you experienced these symptoms?
                                </label>
                                <select id="unknownSymptomDuration">
                                    <option value="none">No symptoms</option>
                                    <option value="recent">Less than 6 months</option>
                                    <option value="moderate" selected>6 months - 2 years</option>
                                    <option value="long">More than 2 years</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="symptomProgression">Rate of symptom progression</label>
                                <select id="symptomProgression">
                                    <option value="slow">Slow/Stable</option>
                                    <option value="moderate" selected>Moderate</option>
                                    <option value="rapid">Rapid</option>
                                </select>
                            </div>
                            
                            <div style="display: flex; gap: 15px; margin-top: 20px;">
                                <button class="cta-button secondary" onclick="prevStep('unknown')">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button class="cta-button" id="calculateUnknownRiskBtn">
                                    <i class="fas fa-calculator"></i> Calculate Risk
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="results-container">
                        <div class="results-header">
                            <div class="risk-circle risk-medium" id="unknownRiskCircle">
                                <span id="unknownRiskPercentage">--%</span>
                            </div>
                            <h3 id="unknownRiskCategory">Complete assessment to see results</h3>
                            <p id="unknownRiskDescription">Based on family history and symptom profile</p>
                        </div>
                        
                        <div class="selected-symptoms">
                            <h4><i class="fas fa-clipboard-list"></i> Selected Symptoms <span class="symptom-count" id="unknownSymptomCount">0</span></h4>
                            <div class="selected-list" id="unknownSelectedList">
                                <div style="text-align: center; color: var(--gray); padding: 20px;">
                                    <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.5;"></i>
                                    <p>No symptoms selected yet</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="risk-metrics">
                            <div class="metric-card">
                                <div class="metric-value" id="unknownLifetimeRisk">--%</div>
                                <div class="metric-label">Estimated Lifetime Risk</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="unknownGeneticRisk">--%</div>
                                <div class="metric-label">Genetic Carrier Probability</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="unknownAgeRisk">--%</div>
                                <div class="metric-label">Age-Adjusted Risk</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-value" id="unknownSeverity">--</div>
                                <div class="metric-label">Symptom Severity Index</div>
                            </div>
                        </div>
                        
                        <!-- Risk Factor Percentage Visualization -->
                        <div class="graph-container">
                            <div class="graph-title">
                                <h4><i class="fas fa-chart-pie"></i> Risk Contribution Percentages</h4>
                                <div class="graph-controls">
                                    <button class="graph-type-btn active" onclick="changeUnknownGraphType('doughnut')">Doughnut</button>
                                    <button class="graph-type-btn" onclick="changeUnknownGraphType('pie')">Pie</button>
                                </div>
                            </div>
                            <div style="height: 250px; position: relative;">
                                <canvas id="unknownRiskChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Percentage Bars for Unknown Risk -->
                        <div class="graph-container">
                            <div class="graph-title">
                                <h4><i class="fas fa-tachometer-alt"></i> Risk Factor Levels</h4>
                            </div>
                            <div id="unknownPercentageBars">
                                <!-- Percentage bars will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Disclaimer Section -->
    <section class="disclaimer-section">
        <div class="container">
            <div class="disclaimer-box">
                <h3><i class="fas fa-exclamation-triangle"></i> Important Disclaimer</h3>
                <div class="disclaimer-content">
                    <p><strong>This tool is for informational and educational purposes only.</strong> It is not a substitute for professional medical advice, diagnosis, or treatment.</p>
                    
                    <ul>
                        <li>This risk calculator provides <strong>estimated probabilities</strong> based on mathematical models and cannot provide a definitive diagnosis</li>
                        <li>Results should be discussed with a qualified healthcare provider, preferably a neurologist or genetic counselor</li>
                        <li>Do not make medical decisions based solely on the results of this calculator</li>
                        <li>If you are experiencing symptoms, please consult with a healthcare professional</li>
                        <li>For genetic testing and definitive diagnosis, consult with a genetic counselor</li>
                    </ul>
                    
                    <p style="margin-top: 15px; font-style: italic;">
                        NeuroPrognos is an educational tool developed for the TILT Initiative. It is not intended for clinical use and should not replace professional medical evaluation.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact-section">
        <div class="container">
            <div class="section-title">
                <h2>Contact Us</h2>
                <p>Get in touch with us for more information</p>
            </div>
            
            <div class="contact-grid">
                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <h4>Email Us</h4>
                    <p>For general inquiries and support</p>
                    <a href="mailto:info@neuroprognos.org" class="contact-link">info@neuroprognos.org</a>
                </div>
                
                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h4>Research Inquiries</h4>
                    <p>For research collaboration and data access</p>
                    <a href="mailto:research@neuroprognos.org" class="contact-link">research@neuroprognos.org</a>
                </div>
                
                <div class="contact-card">
                    <div class="contact-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <h4>TILT Initiative</h4>
                    <p>Learn more about our parent organization</p>
                    <a href="https://tiltinitiative.org" target="_blank" class="contact-link">Visit TILT Initiative</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div>
                    <div class="logo" style="color: white; margin-bottom: 20px;">NeuroPrognos</div>
                    <p>Symptom-specific HD risk assessment with personalized insights.</p>
                    <p style="margin-top: 20px; font-size: 0.9rem; color: #6c757d;">A TILT Initiative Research Platform</p>
                </div>
                
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#home">Home</a></li>
                        <li><a href="#calculator">Risk Calculator</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h4>HD Resources</h4>
                    <ul>
                        <li><a href="https://hdsa.org" target="_blank">Huntington's Disease Society of America</a></li>
                        <li><a href="https://www.huntington-study-group.org" target="_blank">Huntington Study Group</a></li>
                        <li><a href="https://hopes.stanford.edu" target="_blank">HOPES Huntington's Disease</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright" style="text-align: center; padding-top: 30px; border-top: 1px solid #495057; color: #adb5bd;">
                <p>&copy; 2023 NeuroPrognos. A TILT Initiative Project. Symptom-specific HD risk assessment system. v2.4.1</p>
            </div>
        </div>
    </footer>

    <script>
        // Store selected symptoms
        let knownSelectedSymptoms = {};
        let unknownSelectedSymptoms = {};
        
        // Chart instances
        let knownChart, unknownChart;
        let showConfidenceIntervals = false;
        
        // REAL HD Research Formulas
        const HD_FORMULAS = {
            // Langbehn formula for CAG ≥ 36
            langbehn: (age, cag) => {
                if (cag < 36) return 0;
                const mu = (age * cag) / 1000;
                return 1 / (1 + Math.exp(9.56 - 0.146 * mu));
            },
            
            // Age of onset estimation (Penney formula)
            ageOfOnset: (cag) => {
                if (cag < 36) return 'N/A';
                return Math.exp(9.556 - 0.146 * cag) + 25;
            },
            
            // Progression rate (Zhang formula)
            progressionRate: (cag) => {
                if (cag < 40) return 0;
                return 0.72 * (cag - 40);
            },
            
            // TFC decline rate
            tfcDecline: (cag) => {
                return 0.18 + 0.013 * (cag - 40);
            },
            
            // CAP score
            capScore: (age, cag) => {
                return (age * cag) / 1000;
            }
        };

        // Symptom cluster weights based on REAL research
        const SYMPTOM_CLUSTERS = {
            motor: {
                weight: 0.35,
                symptoms: {
                    'chorea': { weight: 0.30, severityMultiplier: 1.5 },
                    'dystonia': { weight: 0.25, severityMultiplier: 1.3 },
                    'bradykinesia': { weight: 0.20, severityMultiplier: 1.2 },
                    'rigidity': { weight: 0.15, severityMultiplier: 1.1 },
                    'gait': { weight: 0.10, severityMultiplier: 1.4 }
                }
            },
            cognitive: {
                weight: 0.30,
                symptoms: {
                    'memory': { weight: 0.30, severityMultiplier: 1.3 },
                    'executive': { weight: 0.25, severityMultiplier: 1.4 },
                    'attention': { weight: 0.20, severityMultiplier: 1.2 },
                    'processing': { weight: 0.15, severityMultiplier: 1.1 },
                    'language': { weight: 0.10, severityMultiplier: 1.2 }
                }
            },
            psychiatric: {
                weight: 0.25,
                symptoms: {
                    'depression': { weight: 0.25, severityMultiplier: 1.2 },
                    'anxiety': { weight: 0.20, severityMultiplier: 1.1 },
                    'irritability': { weight: 0.25, severityMultiplier: 1.3 },
                    'apathy': { weight: 0.30, severityMultiplier: 1.4 }
                }
            },
            functional: {
                weight: 0.10,
                symptoms: {
                    'work': { weight: 0.40, severityMultiplier: 1.5 },
                    'driving': { weight: 0.30, severityMultiplier: 1.4 },
                    'adl': { weight: 0.30, severityMultiplier: 1.3 }
                }
            }
        };

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            initializeSymptoms();
            initializeCharts();
            
            // Set up event listeners
            setupEventListeners();
            
            // Auto-select demo symptoms
            setTimeout(() => {
                selectDemoSymptoms();
                calculateAllRisks();
            }, 500);
            
            // Smooth scrolling for navigation
            document.querySelectorAll('nav a').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    const targetId = this.getAttribute('href');
                    
                    if (targetId.startsWith('#')) {
                        e.preventDefault();
                        const targetElement = document.querySelector(targetId);
                        if (targetElement) {
                            window.scrollTo({
                                top: targetElement.offsetTop - 80,
                                behavior: 'smooth'
                            });
                        }
                    }
                });
            });
        });
        
        // Tab Switching
        document.getElementById('tabKnownBtn').addEventListener('click', () => {
            document.getElementById('tabKnownBtn').classList.add('active');
            document.getElementById('tabUnknownBtn').classList.remove('active');
            document.getElementById('tabKnown').classList.add('active');
            document.getElementById('tabUnknown').classList.remove('active');
            calculateKnownRisk();
        });
        
        document.getElementById('tabUnknownBtn').addEventListener('click', () => {
            document.getElementById('tabUnknownBtn').classList.add('active');
            document.getElementById('tabKnownBtn').classList.remove('active');
            document.getElementById('tabUnknown').classList.add('active');
            document.getElementById('tabKnown').classList.remove('active');
            calculateUnknownRisk();
        });
        
        // Step Navigation
        function getCurrentStep(type) {
            const tabId = type === 'known' ? 'tabKnown' : 'tabUnknown';
            const activeStep = document.querySelector(`#${tabId} .form-step.active`);
            if (!activeStep) return 1;
            
            const stepId = activeStep.id;
            return parseInt(stepId.replace(`${type}Step`, ''));
        }
        
        function nextStep(type) {
            const currentStep = getCurrentStep(type);
            const nextStepNumber = currentStep + 1;
            
            // Hide current step
            const currentStepEl = document.getElementById(`${type}Step${currentStep}`);
            if (currentStepEl) currentStepEl.classList.remove('active');
            
            // Show next step
            const nextStepEl = document.getElementById(`${type}Step${nextStepNumber}`);
            if (nextStepEl) {
                nextStepEl.classList.add('active');
            }
            
            // Update step indicators
            updateStepIndicators(type, nextStepNumber);
            
            // Update results if on final step
            if (type === 'known' && nextStepNumber === 4) {
                calculateKnownRisk();
            } else if (type === 'unknown' && nextStepNumber === 3) {
                calculateUnknownRisk();
            }
        }
        
        function prevStep(type) {
            const currentStep = getCurrentStep(type);
            const prevStepNumber = currentStep - 1;
            
            if (prevStepNumber < 1) return;
            
            // Hide current step
            const currentStepEl = document.getElementById(`${type}Step${currentStep}`);
            if (currentStepEl) currentStepEl.classList.remove('active');
            
            // Show previous step
            const prevStepEl = document.getElementById(`${type}Step${prevStepNumber}`);
            if (prevStepEl) {
                prevStepEl.classList.add('active');
            }
            
            // Update step indicators
            updateStepIndicators(type, prevStepNumber);
        }
        
        function goToStep(type, stepNumber) {
            // Hide all steps for this type
            const steps = document.querySelectorAll(`#${type}Step1, #${type}Step2, #${type}Step3, #${type}Step4`);
            steps.forEach(s => {
                if (s) s.classList.remove('active');
            });
            
            // Show selected step
            const stepEl = document.getElementById(`${type}Step${stepNumber}`);
            if (stepEl) {
                stepEl.classList.add('active');
            }
            
            // Update step indicators
            updateStepIndicators(type, stepNumber);
            
            // Update results if on final step
            if (type === 'known' && stepNumber === 4) {
                calculateKnownRisk();
            } else if (type === 'unknown' && stepNumber === 3) {
                calculateUnknownRisk();
            }
        }
        
        function updateStepIndicators(type, activeStepNumber) {
            const tabId = type === 'known' ? 'tabKnown' : 'tabUnknown';
            const steps = document.querySelectorAll(`#${tabId} .step`);
            
            steps.forEach(step => {
                const stepNumber = parseInt(step.dataset.step);
                if (stepNumber <= activeStepNumber) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }
        
        // Symptom Database
        const symptomDatabase = {
            motor: [
                { id: 'chorea', name: 'Chorea', description: 'Involuntary dance-like movements' },
                { id: 'dystonia', name: 'Dystonia', description: 'Sustained muscle contractions' },
                { id: 'bradykinesia', name: 'Bradykinesia', description: 'Slowness of movement' },
                { id: 'rigidity', name: 'Rigidity', description: 'Increased muscle tone' },
                { id: 'gait', name: 'Gait disturbance', description: 'Walking difficulties' },
                { id: 'balance', name: 'Balance problems', description: 'Postural instability' },
                { id: 'dysarthria', name: 'Dysarthria', description: 'Speech difficulties' }
            ],
            cognitive: [
                { id: 'memory', name: 'Memory impairment', description: 'Short-term memory problems' },
                { id: 'executive', name: 'Executive dysfunction', description: 'Planning/organization issues' },
                { id: 'attention', name: 'Attention deficits', description: 'Difficulty sustaining attention' },
                { id: 'processing', name: 'Processing speed', description: 'Slowed thinking speed' },
                { id: 'language', name: 'Language difficulties', description: 'Word finding problems' }
            ],
            psychiatric: [
                { id: 'depression', name: 'Depression', description: 'Persistent low mood' },
                { id: 'anxiety', name: 'Anxiety', description: 'Excessive worry' },
                { id: 'irritability', name: 'Irritability', description: 'Easily angered' },
                { id: 'apathy', name: 'Apathy', description: 'Lack of motivation' },
                { id: 'obsessive', name: 'Obsessive-compulsive', description: 'Repetitive thoughts/behaviors' }
            ],
            functional: [
                { id: 'work', name: 'Work disability', description: 'Unable to work' },
                { id: 'driving', name: 'Driving impairment', description: 'Unable to drive safely' },
                { id: 'adl', name: 'ADL limitations', description: 'Daily activities difficult' },
                { id: 'household', name: 'Household tasks', description: 'Difficulty with chores' }
            ]
        };
        
        // Unknown CAG symptoms
        const unknownSymptoms = {
            motor: [
                { id: 'unknown-chorea', name: 'Involuntary movements', description: 'Uncontrolled movements' },
                { id: 'unknown-gait', name: 'Gait problems', description: 'Walking difficulties' },
                { id: 'unknown-balance', name: 'Balance issues', description: 'Problems with balance' },
                { id: 'unknown-slowness', name: 'Slowed movements', description: 'General slowing' }
            ],
            cognitive: [
                { id: 'unknown-memory', name: 'Memory problems', description: 'Forgetfulness' },
                { id: 'unknown-concentration', name: 'Poor concentration', description: 'Focus issues' },
                { id: 'unknown-planning', name: 'Planning difficulties', description: 'Trouble organizing tasks' }
            ],
            psychiatric: [
                { id: 'unknown-depression', name: 'Depression', description: 'Low mood' },
                { id: 'unknown-anxiety', name: 'Anxiety', description: 'Worry or nervousness' },
                { id: 'unknown-irritability', name: 'Irritability', description: 'Easily angered' },
                { id: 'unknown-apathy', name: 'Apathy/Lack of motivation', description: 'Loss of interest' }
            ]
        };
        
        function initializeSymptoms() {
            // Known CAG symptoms
            Object.keys(symptomDatabase).forEach(category => {
                const container = document.getElementById(`${category}List`);
                if (!container) return;
                
                container.innerHTML = '';
                
                symptomDatabase[category].forEach(symptom => {
                    const symptomItem = createSymptomItem(symptom, category, 'known');
                    container.appendChild(symptomItem);
                });
            });
            
            // Unknown CAG symptoms
            Object.keys(unknownSymptoms).forEach(category => {
                const container = document.getElementById(`unknown${category.charAt(0).toUpperCase() + category.slice(1)}List`);
                if (!container) return;
                
                container.innerHTML = '';
                
                unknownSymptoms[category].forEach(symptom => {
                    const symptomItem = createSymptomItem(symptom, category, 'unknown');
                    container.appendChild(symptomItem);
                });
            });
        }
        
        function createSymptomItem(symptom, category, type) {
            const div = document.createElement('div');
            div.className = 'symptom-item';
            div.dataset.id = symptom.id;
            div.dataset.category = category;
            div.dataset.type = type;
            
            if (type === 'known') {
                div.innerHTML = `
                    <div class="symptom-checkbox">
                        <input type="checkbox" id="${symptom.id}">
                        <span class="checkmark"></span>
                    </div>
                    <div class="symptom-info">
                        <div class="symptom-label">${symptom.name}</div>
                        <div class="symptom-description" style="font-size: 0.85rem; color: var(--gray); margin-top: 3px;">
                            ${symptom.description}
                        </div>
                    </div>
                    <div class="severity-selector">
                        <button class="severity-btn mild" data-severity="mild" data-tooltip="Mild">M</button>
                        <button class="severity-btn moderate" data-severity="moderate" data-tooltip="Moderate">M</button>
                        <button class="severity-btn severe" data-severity="severe" data-tooltip="Severe">S</button>
                    </div>
                `;
            } else {
                div.innerHTML = `
                    <div class="symptom-checkbox">
                        <input type="checkbox" id="${symptom.id}">
                        <span class="checkmark"></span>
                    </div>
                    <div class="symptom-info">
                        <div class="symptom-label">${symptom.name}</div>
                        <div class="symptom-description" style="font-size: 0.85rem; color: var(--gray); margin-top: 3px;">
                            ${symptom.description}
                        </div>
                    </div>
                `;
            }
            
            // Add event listeners
            const checkbox = div.querySelector('input[type="checkbox"]');
            const severityBtns = div.querySelectorAll('.severity-btn');
            
            // Click on item toggles selection
            div.addEventListener('click', function(e) {
                if (!e.target.classList.contains('severity-btn')) {
                    checkbox.checked = !checkbox.checked;
                    updateSymptomSelection(symptom.id, checkbox.checked, category, type);
                }
            });
            
            // Checkbox change
            checkbox.addEventListener('change', function() {
                updateSymptomSelection(symptom.id, this.checked, category, type);
            });
            
            // Severity buttons (for known CAG only)
            if (severityBtns.length > 0) {
                severityBtns.forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        
                        // Remove active class from all buttons in this item
                        severityBtns.forEach(b => b.classList.remove('active'));
                        
                        // Add active class to clicked button
                        this.classList.add('active');
                        
                        // Check the checkbox if not already checked
                        if (!checkbox.checked) {
                            checkbox.checked = true;
                            updateSymptomSelection(symptom.id, true, category, type);
                        } else {
                            // Update severity for existing selection
                            if (type === 'known' && knownSelectedSymptoms[symptom.id]) {
                                knownSelectedSymptoms[symptom.id].severity = this.dataset.severity;
                                updateSelectedList(type);
                            }
                        }
                    });
                });
            }
            
            return div;
        }
        
        function updateSymptomSelection(symptomId, isSelected, category, type) {
            const symptomItem = document.querySelector(`[data-id="${symptomId}"][data-type="${type}"]`);
            
            if (type === 'known') {
                if (isSelected) {
                    if (!knownSelectedSymptoms[symptomId]) {
                        const symptom = symptomDatabase[category].find(s => s.id === symptomId);
                        const severityBtn = symptomItem.querySelector('.severity-btn.active');
                        const severity = severityBtn ? severityBtn.dataset.severity : 'mild';
                        
                        knownSelectedSymptoms[symptomId] = {
                            name: symptom.name,
                            category: category,
                            severity: severity
                        };
                        
                        // Make sure at least one severity is selected
                        if (!severityBtn) {
                            const mildBtn = symptomItem.querySelector('.severity-btn.mild');
                            if (mildBtn) {
                                mildBtn.classList.add('active');
                                knownSelectedSymptoms[symptomId].severity = 'mild';
                            }
                        }
                        
                        symptomItem.classList.add('selected');
                    }
                } else {
                    delete knownSelectedSymptoms[symptomId];
                    symptomItem.classList.remove('selected');
                    symptomItem.querySelectorAll('.severity-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                }
                updateSelectedList('known');
                calculateKnownRisk();
            } else {
                if (isSelected) {
                    const symptom = unknownSymptoms[category].find(s => s.id === symptomId);
                    unknownSelectedSymptoms[symptomId] = {
                        name: symptom.name,
                        category: category
                    };
                    symptomItem.classList.add('selected');
                } else {
                    delete unknownSelectedSymptoms[symptomId];
                    symptomItem.classList.remove('selected');
                }
                updateSelectedList('unknown');
                calculateUnknownRisk();
            }
        }
        
        function updateSelectedList(type) {
            if (type === 'known') {
                const container = document.getElementById('knownSelectedList');
                const countElement = document.getElementById('knownSymptomCount');
                const symptoms = knownSelectedSymptoms;
                
                countElement.textContent = Object.keys(symptoms).length;
                
                if (Object.keys(symptoms).length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; color: var(--gray); padding: 20px;">
                            <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.5;"></i>
                            <p>No symptoms selected yet</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = '';
                
                // Group by category
                const grouped = {};
                Object.values(symptoms).forEach(symptom => {
                    if (!grouped[symptom.category]) grouped[symptom.category] = [];
                    grouped[symptom.category].push(symptom);
                });
                
                Object.keys(grouped).forEach(category => {
                    grouped[category].forEach(symptom => {
                        const item = document.createElement('div');
                        item.className = 'selected-item';
                        item.innerHTML = `
                            <span>${symptom.name}</span>
                            <span class="severity-badge severity-${symptom.severity}">
                                ${symptom.severity.charAt(0).toUpperCase() + symptom.severity.slice(1)}
                            </span>
                        `;
                        container.appendChild(item);
                    });
                });
            } else {
                const container = document.getElementById('unknownSelectedList');
                const countElement = document.getElementById('unknownSymptomCount');
                const symptoms = unknownSelectedSymptoms;
                
                countElement.textContent = Object.keys(symptoms).length;
                
                if (Object.keys(symptoms).length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; color: var(--gray); padding: 20px;">
                            <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.5;"></i>
                            <p>No symptoms selected yet</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = '';
                
                // Group by category
                const grouped = {};
                Object.values(symptoms).forEach(symptom => {
                    if (!grouped[symptom.category]) grouped[symptom.category] = [];
                    grouped[symptom.category].push(symptom);
                });
                
                Object.keys(grouped).forEach(category => {
                    grouped[category].forEach(symptom => {
                        const item = document.createElement('div');
                        item.className = 'selected-item';
                        item.innerHTML = `<span>${symptom.name}</span>`;
                        container.appendChild(item);
                    });
                });
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            // Known CAG Progression Chart
            const knownCtx = document.getElementById('knownProgressionChart');
            if (knownCtx) {
                knownChart = new Chart(knownCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Current', '+2 years', '+4 years', '+6 years', '+8 years', '+10 years'],
                        datasets: [{
                            label: 'Disease Progression',
                            data: [30, 45, 60, 70, 80, 85],
                            borderColor: 'rgb(42, 92, 138)',
                            backgroundColor: 'rgba(42, 92, 138, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Risk Percentage (%)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time from Present'
                                }
                            }
                        }
                    }
                });
            }
            
            // Unknown CAG Risk Chart
            const unknownCtx = document.getElementById('unknownRiskChart');
            if (unknownCtx) {
                unknownChart = new Chart(unknownCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Family History', 'Symptoms', 'Duration', 'Progression', 'Age'],
                        datasets: [{
                            data: [25, 30, 20, 15, 10],
                            backgroundColor: [
                                'rgba(42, 92, 138, 0.8)',
                                'rgba(74, 159, 213, 0.8)',
                                'rgba(255, 107, 107, 0.8)',
                                'rgba(255, 193, 7, 0.8)',
                                'rgba(108, 117, 125, 0.8)'
                            ],
                            borderColor: [
                                'rgb(42, 92, 138)',
                                'rgb(74, 159, 213)',
                                'rgb(255, 107, 107)',
                                'rgb(255, 193, 7)',
                                'rgb(108, 117, 125)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    boxWidth: 12,
                                    padding: 15
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Graph control functions
        function changeGraphType(type, newType) {
            if (type === 'known' && knownChart) {
                knownChart.config.type = newType;
                
                // Update button states
                const buttons = document.querySelectorAll('#tabKnown .graph-controls .graph-type-btn');
                buttons.forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.textContent.toLowerCase() === newType) {
                        btn.classList.add('active');
                    }
                });
                
                knownChart.update();
            }
        }
        
        function changeUnknownGraphType(newType) {
            if (unknownChart) {
                unknownChart.config.type = newType;
                
                // Update button states
                const buttons = document.querySelectorAll('#tabUnknown .graph-controls .graph-type-btn');
                buttons.forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.textContent.toLowerCase() === newType) {
                        btn.classList.add('active');
                    }
                });
                
                unknownChart.update();
            }
        }
        
        function toggleConfidenceIntervals(type) {
            showConfidenceIntervals = !showConfidenceIntervals;
            
            if (type === 'known' && knownChart) {
                // Update button state
                const btn = document.querySelector('#tabKnown .graph-controls button:nth-child(3)');
                btn.classList.toggle('active', showConfidenceIntervals);
                
                // In a real app, you would update the chart data here
                // For now, we'll just update the title
                knownChart.options.plugins.title = {
                    display: true,
                    text: showConfidenceIntervals ? 'Disease Progression with Confidence Intervals' : 'Disease Progression Timeline'
                };
                knownChart.update();
            }
        }
        
        // Update percentage displays
        function updateKnownPercentageBreakdown() {
            const container = document.getElementById('knownPercentageBreakdown');
            if (!container) return;
            
            const age = parseInt(document.getElementById('knownAge')?.value) || 35;
            const cag = parseInt(document.getElementById('knownCAG')?.value) || 42;
            const symptomCount = Object.keys(knownSelectedSymptoms).length;
            
            // Calculate percentages
            const cagPercentage = Math.min(70, (cag - 35) * 3);
            const agePercentage = Math.min(40, (age - 20) * 1.5);
            const symptomPercentage = Math.min(60, symptomCount * 15);
            
            const percentages = [
                { label: 'CAG Repeat Length', value: cagPercentage, color: 'var(--primary)' },
                { label: 'Current Age', value: agePercentage, color: 'var(--secondary)' },
                { label: 'Symptom Count', value: symptomPercentage, color: 'var(--danger)' }
            ];
            
            container.innerHTML = '';
            
            percentages.forEach(item => {
                const percentageHTML = `
                    <div class="percentage-display">
                        <div class="percentage-value">${Math.round(item.value)}%</div>
                        <div class="percentage-bar">
                            <div class="percentage-fill" style="width: ${item.value}%; background: ${item.color};"></div>
                        </div>
                    </div>
                    <div class="percentage-label">${item.label}</div>
                `;
                container.innerHTML += percentageHTML;
            });
        }
        
        function updateUnknownPercentageBars() {
            const container = document.getElementById('unknownPercentageBars');
            if (!container) return;
            
            const symptomCount = Object.keys(unknownSelectedSymptoms).length;
            const familyHistory = document.getElementById('familyHistory')?.value || 'none';
            const duration = document.getElementById('unknownSymptomDuration')?.value || 'moderate';
            const progression = document.getElementById('symptomProgression')?.value || 'moderate';
            const age = parseInt(document.getElementById('unknownAge')?.value) || 35;
            
            // Calculate percentages
            const familyPercentage = familyHistory === 'none' ? 10 : 
                                   familyHistory === 'second' ? 30 :
                                   familyHistory === 'first' ? 50 : 70;
            
            const symptomPercentage = Math.min(80, symptomCount * 25);
            const durationPercentage = duration === 'none' ? 5 :
                                      duration === 'recent' ? 20 :
                                      duration === 'moderate' ? 40 : 60;
            
            const progressionPercentage = progression === 'slow' ? 10 :
                                         progression === 'moderate' ? 30 : 50;
            
            const agePercentage = age > 50 ? 40 : age > 40 ? 25 : 10;
            
            const percentages = [
                { label: 'Family History Risk', value: familyPercentage, color: 'var(--primary)' },
                { label: 'Symptom Presence', value: symptomPercentage, color: 'var(--danger)' },
                { label: 'Symptom Duration', value: durationPercentage, color: 'var(--warning)' },
                { label: 'Progression Rate', value: progressionPercentage, color: 'var(--info)' },
                { label: 'Age Factor', value: agePercentage, color: 'var(--secondary)' }
            ];
            
            container.innerHTML = '';
            
            percentages.forEach(item => {
                const percentageHTML = `
                    <div class="percentage-display">
                        <div class="percentage-value">${Math.round(item.value)}%</div>
                        <div class="percentage-bar">
                            <div class="percentage-fill" style="width: ${item.value}%; background: ${item.color};"></div>
                        </div>
                    </div>
                    <div class="percentage-label">${item.label}</div>
                `;
                container.innerHTML += percentageHTML;
            });
        }
        
        // REAL HD Calculations
        function updateRealCalculations() {
            const age = parseInt(document.getElementById('knownAge').value) || 35;
            const cag = parseInt(document.getElementById('knownCAG').value) || 42;
            
            // Calculate using REAL formulas
            const capScore = HD_FORMULAS.capScore(age, cag);
            const langbehnRisk = HD_FORMULAS.langbehn(age, cag) * 100;
            const onsetAge = HD_FORMULAS.ageOfOnset(cag);
            const progressionRate = HD_FORMULAS.progressionRate(cag);
            const tfcDecline = HD_FORMULAS.tfcDecline(cag);
            
            // Update real metrics display
            document.getElementById('realCAPScore').textContent = capScore.toFixed(1);
            document.getElementById('realProgressionRate').textContent = progressionRate.toFixed(2);
            document.getElementById('realTFCDecline').textContent = tfcDecline.toFixed(2);
            document.getElementById('realAgeOnset').textContent = typeof onsetAge === 'number' ? onsetAge.toFixed(0) : onsetAge;
            
            // Update symptom cluster analysis
            updateSymptomClusters();
            
            // Update timeline
            updateTimeline(age, cag, langbehnRisk);
            
            // Update comparison metrics
            updateComparisonMetrics(langbehnRisk);
        }
        
        // Update symptom cluster visualization
        function updateSymptomClusters() {
            const clusterGrid = document.getElementById('symptomClusterGrid');
            if (!clusterGrid) return;
            
            clusterGrid.innerHTML = '';
            
            const clusters = ['motor', 'cognitive', 'psychiatric', 'functional'];
            
            clusters.forEach(clusterName => {
                const cluster = SYMPTOM_CLUSTERS[clusterName];
                const selectedSymptoms = getSymptomsByCluster(clusterName);
                
                // Calculate cluster impact
                let clusterImpact = 0;
                let breakdownHTML = '';
                
                selectedSymptoms.forEach(symptom => {
                    const symptomData = cluster.symptoms[symptom.id];
                    if (symptomData) {
                        const severityValue = symptom.severity === 'mild' ? 0.5 : 
                                           symptom.severity === 'moderate' ? 1.0 : 1.5;
                        const impact = (symptomData.weight * 100 * severityValue * symptomData.severityMultiplier).toFixed(1);
                        clusterImpact += parseFloat(impact);
                        
                        breakdownHTML += `
                            <div class="cluster-item">
                                <span class="item-name">${symptom.name}</span>
                                <span class="item-value">${impact}%</span>
                            </div>
                        `;
                    }
                });
                
                // Limit impact to 100%
                clusterImpact = Math.min(100, clusterImpact);
                
                const clusterCard = document.createElement('div');
                clusterCard.className = `cluster-card ${clusterName}`;
                clusterCard.innerHTML = `
                    <div class="cluster-title">
                        <h5><i class="fas fa-${getClusterIcon(clusterName)}"></i> ${clusterName.charAt(0).toUpperCase() + clusterName.slice(1)} Impact</h5>
                        <div class="cluster-value">${clusterImpact.toFixed(1)}%</div>
                    </div>
                    <div class="cluster-bar">
                        <div class="cluster-fill" style="width: ${clusterImpact}%; background: ${getClusterColor(clusterName)};"></div>
                    </div>
                    <div class="cluster-breakdown">
                        ${breakdownHTML || '<div class="cluster-item"><span class="item-name">No symptoms selected</span><span class="item-value">0%</span></div>'}
                    </div>
                `;
                
                clusterGrid.appendChild(clusterCard);
            });
        }
        
        // Helper functions for symptom clusters
        function getSymptomsByCluster(clusterName) {
            const symptoms = [];
            Object.values(knownSelectedSymptoms).forEach(symptom => {
                if (symptom.category === clusterName) {
                    symptoms.push(symptom);
                }
            });
            return symptoms;
        }
        
        function getClusterIcon(clusterName) {
            const icons = {
                motor: 'running',
                cognitive: 'brain',
                psychiatric: 'heartbeat',
                functional: 'tasks'
            };
            return icons[clusterName] || 'circle';
        }
        
        function getClusterColor(clusterName) {
            const colors = {
                motor: 'var(--danger)',
                cognitive: 'var(--warning)',
                psychiatric: 'var(--info)',
                functional: 'var(--secondary)'
            };
            return colors[clusterName] || 'var(--primary)';
        }
        
        function updateTimeline(age, cag, risk) {
            const premanifest = document.getElementById('premanifestTimeline');
            const prodromal = document.getElementById('prodromalTimeline');
            const manifest = document.getElementById('manifestTimeline');
            
            if (cag >= 36) {
                const onsetAge = HD_FORMULAS.ageOfOnset(cag);
                const yearsToOnset = Math.max(0, onsetAge - age);
                
                if (risk < 20) {
                    premanifest.textContent = `Estimated ${yearsToOnset.toFixed(0)} years to expected onset`;
                    prodromal.textContent = 'Prodromal stage may begin in 5-10 years';
                    manifest.textContent = `Expected onset around age ${onsetAge.toFixed(0)}`;
                } else if (risk < 50) {
                    premanifest.textContent = 'Early prodromal changes may be present';
                    prodromal.textContent = 'Subtle symptoms detectable on examination';
                    manifest.textContent = `Expected diagnosis in ${yearsToOnset.toFixed(0)} years`;
                } else {
                    premanifest.textContent = 'Transitioning to prodromal stage';
                    prodromal.textContent = 'Clear prodromal symptoms present';
                    manifest.textContent = 'Likely early manifest HD - consider clinical evaluation';
                }
            } else {
                premanifest.textContent = 'Low risk for manifest HD';
                prodromal.textContent = 'Regular monitoring recommended';
                manifest.textContent = 'Clinical evaluation if symptoms progress';
            }
        }
        
        function updateComparisonMetrics(risk) {
            const baseline = 0.01; // 0.01% baseline risk
            const relativeIncrease = risk > 0 ? (risk / baseline).toFixed(0) : 0;
            
            document.getElementById('comparisonRisk').textContent = risk.toFixed(1) + '%';
            document.getElementById('relativeIncrease').textContent = relativeIncrease + 'x';
        }
        
        // View specific symptom cluster
        function viewCluster(cluster) {
            const buttons = document.querySelectorAll('.cluster-filters .cluster-filter-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            event.target.classList.add('active');
            
            // Filter clusters based on selection
            const clusters = document.querySelectorAll('.cluster-card');
            clusters.forEach(clusterCard => {
                if (cluster === 'all') {
                    clusterCard.style.display = 'block';
                } else {
                    if (clusterCard.classList.contains(cluster)) {
                        clusterCard.style.display = 'block';
                    } else {
                        clusterCard.style.display = 'none';
                    }
                }
            });
        }
        
        // Enhanced Risk Calculation Functions
        function calculateKnownRisk() {
            try {
                const age = parseInt(document.getElementById('knownAge').value) || 35;
                const cag = parseInt(document.getElementById('knownCAG').value) || 42;
                const symptomCount = Object.keys(knownSelectedSymptoms).length;
                
                // Calculate severity score
                let severityScore = 0;
                Object.values(knownSelectedSymptoms).forEach(symptom => {
                    switch(symptom.severity) {
                        case 'mild': severityScore += 1; break;
                        case 'moderate': severityScore += 2; break;
                        case 'severe': severityScore += 3; break;
                    }
                });
                
                // Base risk calculation using REAL formula
                let baseRisk = 0;
                if (cag >= 40) baseRisk = 50;
                else if (cag >= 36) baseRisk = 30;
                else baseRisk = 5;
                
                // Adjust for symptoms and severity
                const symptomAdjustment = (symptomCount * 5) + (severityScore * 3);
                const totalRisk = Math.min(95, baseRisk + symptomAdjustment);
                
                // Calculate other metrics
                const fiveYearRisk = Math.min(90, totalRisk * 0.6);
                const tenYearRisk = Math.min(90, totalRisk * 0.8);
                const expectedOnset = cag >= 40 ? 45 : cag >= 36 ? 55 : 65;
                const capScore = ((age * cag) / 1000).toFixed(1);
                
                // Update display
                document.getElementById('knownRiskPercentage').textContent = Math.round(totalRisk) + '%';
                document.getElementById('knownFiveYearRisk').textContent = Math.round(fiveYearRisk) + '%';
                document.getElementById('knownTenYearRisk').textContent = Math.round(tenYearRisk) + '%';
                document.getElementById('knownExpectedOnset').textContent = expectedOnset;
                document.getElementById('knownCAPScore').textContent = capScore;
                
                // Update risk circle
                const riskCircle = document.getElementById('knownRiskCircle');
                riskCircle.className = 'risk-circle ';
                if (totalRisk < 30) {
                    riskCircle.classList.add('risk-low');
                    document.getElementById('knownRiskCategory').textContent = 'Low Risk';
                } else if (totalRisk < 60) {
                    riskCircle.classList.add('risk-medium');
                    document.getElementById('knownRiskCategory').textContent = 'Medium Risk';
                } else {
                    riskCircle.classList.add('risk-high');
                    document.getElementById('knownRiskCategory').textContent = 'High Risk';
                }
                
                // Update chart data
                if (knownChart) {
                    const progression = [totalRisk * 0.3, totalRisk * 0.5, totalRisk * 0.7, totalRisk * 0.85, totalRisk * 0.95, totalRisk];
                    knownChart.data.datasets[0].data = progression;
                    knownChart.update();
                }
                
                // Update percentage breakdown
                updateKnownPercentageBreakdown();
                
                // Update REAL calculations
                updateRealCalculations();
                
                return totalRisk;
            } catch (error) {
                console.error('Error in calculateKnownRisk:', error);
                return 0;
            }
        }
        
        function calculateUnknownRisk() {
            try {
                const age = parseInt(document.getElementById('unknownAge').value) || 35;
                const symptomCount = Object.keys(unknownSelectedSymptoms).length;
                const duration = document.getElementById('unknownSymptomDuration').value;
                const familyHistory = document.getElementById('familyHistory').value;
                const progression = document.getElementById('symptomProgression').value;
                
                // Base risk based on family history
                let baseRisk = 0;
                switch(familyHistory) {
                    case 'none': baseRisk = 5; break;
                    case 'second': baseRisk = 25; break;
                    case 'first': baseRisk = 50; break;
                    case 'multiple': baseRisk = 70; break;
                }
                
                // Adjust for symptoms
                const symptomAdjustment = symptomCount * 8;
                
                // Adjust for duration
                let durationAdjustment = 0;
                switch(duration) {
                    case 'recent': durationAdjustment = 5; break;
                    case 'moderate': durationAdjustment = 15; break;
                    case 'long': durationAdjustment = 25; break;
                }
                
                // Adjust for progression
                let progressionAdjustment = 0;
                switch(progression) {
                    case 'slow': progressionAdjustment = -5; break;
                    case 'rapid': progressionAdjustment = 15; break;
                }
                
                // Age adjustment
                let ageAdjustment = 0;
                if (age > 40) ageAdjustment += 10;
                if (age > 50) ageAdjustment += 15;
                
                const totalRisk = Math.min(95, baseRisk + symptomAdjustment + durationAdjustment + progressionAdjustment + ageAdjustment);
                const lifetimeRisk = Math.min(95, totalRisk * 1.2);
                const ageAdjustedRisk = Math.min(95, totalRisk * (1 + (age - 35) * 0.01));
                
                // Calculate symptom severity index (1-10)
                const severityIndex = Math.min(10, Math.max(1, Math.round((symptomCount * 2 + durationAdjustment/5) / 3)));
                
                // Update display
                document.getElementById('unknownRiskPercentage').textContent = Math.round(totalRisk) + '%';
                document.getElementById('unknownLifetimeRisk').textContent = Math.round(lifetimeRisk) + '%';
                document.getElementById('unknownGeneticRisk').textContent = Math.round(totalRisk * 0.8) + '%';
                document.getElementById('unknownAgeRisk').textContent = Math.round(ageAdjustedRisk) + '%';
                document.getElementById('unknownSeverity').textContent = severityIndex;
                
                // Update risk circle
                const riskCircle = document.getElementById('unknownRiskCircle');
                riskCircle.className = 'risk-circle ';
                if (totalRisk < 25) {
                    riskCircle.classList.add('risk-low');
                    document.getElementById('unknownRiskCategory').textContent = 'Low Risk';
                } else if (totalRisk < 50) {
                    riskCircle.classList.add('risk-medium');
                    document.getElementById('unknownRiskCategory').textContent = 'Medium Risk';
                } else {
                    riskCircle.classList.add('risk-high');
                    document.getElementById('unknownRiskCategory').textContent = 'High Risk';
                }
                
                // Update chart data
                if (unknownChart) {
                    const chartData = [
                        familyHistory === 'none' ? 10 : familyHistory === 'second' ? 30 : familyHistory === 'first' ? 50 : 70,
                        Math.min(80, symptomCount * 25),
                        duration === 'none' ? 5 : duration === 'recent' ? 20 : duration === 'moderate' ? 40 : 60,
                        progression === 'slow' ? 10 : progression === 'moderate' ? 30 : 50,
                        age > 50 ? 40 : age > 40 ? 25 : 10
                    ];
                    unknownChart.data.datasets[0].data = chartData;
                    unknownChart.update();
                }
                
                // Update percentage bars
                updateUnknownPercentageBars();
                
                return totalRisk;
            } catch (error) {
                console.error('Error in calculateUnknownRisk:', error);
                return 0;
            }
        }
        
        function calculateAllRisks() {
            calculateKnownRisk();
            calculateUnknownRisk();
        }
        
        function selectDemoSymptoms() {
            // Known CAG demo symptoms
            const knownDemoSymptoms = ['chorea', 'memory', 'depression', 'work'];
            knownDemoSymptoms.forEach(symptomId => {
                const checkbox = document.getElementById(symptomId);
                if (checkbox) {
                    checkbox.checked = true;
                    const category = symptomId === 'chorea' ? 'motor' :
                                   symptomId === 'memory' ? 'cognitive' :
                                   symptomId === 'depression' ? 'psychiatric' : 'functional';
                    updateSymptomSelection(symptomId, true, category, 'known');
                    
                    // Set severity for demo symptoms
                    const severityBtn = document.querySelector(`[data-id="${symptomId}"] .severity-btn.moderate`);
                    if (severityBtn) {
                        severityBtn.click();
                    }
                }
            });
            
            // Unknown CAG demo symptoms
            const unknownDemo = ['unknown-chorea', 'unknown-memory', 'unknown-anxiety'];
            unknownDemo.forEach(symptomId => {
                const checkbox = document.getElementById(symptomId);
                if (checkbox) {
                    checkbox.checked = true;
                    const category = symptomId.includes('chorea') ? 'motor' :
                                   symptomId.includes('memory') ? 'cognitive' : 'psychiatric';
                    updateSymptomSelection(symptomId, true, category, 'unknown');
                }
            });
        }
        
        function setupEventListeners() {
            // Add Calculate Risk button listeners
            document.getElementById('calculateKnownRiskBtn')?.addEventListener('click', calculateKnownRisk);
            document.getElementById('calculateUnknownRiskBtn')?.addEventListener('click', calculateUnknownRisk);
            
            // Add input listeners for real-time updates
            document.getElementById('knownAge')?.addEventListener('input', calculateKnownRisk);
            document.getElementById('knownCAG')?.addEventListener('input', calculateKnownRisk);
            document.getElementById('unknownAge')?.addEventListener('input', calculateUnknownRisk);
            document.getElementById('familyHistory')?.addEventListener('change', calculateUnknownRisk);
            document.getElementById('unknownSymptomDuration')?.addEventListener('change', calculateUnknownRisk);
            document.getElementById('symptomProgression')?.addEventListener('change', calculateUnknownRisk);
        }
    </script>
</body>
</html>
